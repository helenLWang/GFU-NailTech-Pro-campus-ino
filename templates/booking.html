{% extends "base.html" %}

{% block title %}Book Appointment - GFU Nail{% endblock %}

{% block content %}
<div class="pt-24 pb-16 min-h-screen bg-gray-50">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
            <h1 class="text-4xl font-bold text-gray-900 mb-4">Book Your Appointment</h1>
            <p class="text-gray-600 text-lg">Schedule your nail service with us</p>
        </div>
        
        <div class="bg-white rounded-lg shadow-sm p-8">
            <form id="booking-form" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Service Type</label>
                    <select name="service_type" required class="w-full">
                        <option value="">Select a service</option>
                        <option value="press_on_application">Press-On Nail Application</option>
                        <option value="custom_design">Custom Design</option>
                        <option value="nail_art">Nail Art</option>
                        <option value="consultation">Consultation</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Date</label>
                    <input type="date" name="date" id="booking-date" required class="w-full" min="">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Time</label>
                    <select name="time" id="time-slots" required class="w-full">
                        <option value="">Select a time slot</option>
                    </select>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Full Name</label>
                        <input type="text" name="name" required class="w-full">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" name="email" required class="w-full">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                    <input type="tel" name="phone" required class="w-full">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Special Requests (Optional)</label>
                    <textarea name="notes" rows="4" class="w-full"></textarea>
                </div>
                
                <button type="submit" class="w-full btn-primary">
                    Confirm Booking
                </button>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Set minimum date to today
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('booking-date').setAttribute('min', today);
    
    // Load time slots when date is selected
    document.getElementById('booking-date').addEventListener('change', function() {
        const date = this.value;
        if (date) {
            loadTimeSlots(date);
        }
    });
    
    // Handle form submission
    document.getElementById('booking-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        const data = Object.fromEntries(formData);
        
        fetch('/booking/api/book', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                GFUNail.showNotification('Booking confirmed!', 'success');
                this.reset();
            } else {
                GFUNail.showNotification(data.error || 'Error creating booking', 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            GFUNail.showNotification('Error creating booking', 'error');
        });
    });
    
    function loadTimeSlots(date) {
        fetch(`/booking/api/available-slots?date=${date}`)
            .then(response => response.json())
            .then(data => {
                const select = document.getElementById('time-slots');
                select.innerHTML = '<option value="">Select a time slot</option>';
                data.slots.forEach(slot => {
                    if (slot.available) {
                        const option = document.createElement('option');
                        option.value = slot.time;
                        option.textContent = slot.time;
                        select.appendChild(option);
                    }
                });
            })
            .catch(error => {
                console.error('Error loading time slots:', error);
            });
    }
});
</script>
{% endblock %}

